<script type="text/javascript">
    $(function () {
        $('[data-toggle="popover"]').popover()
    })

    function addToCart(meal) {
        fetch(`/cart/${meal}`, {
            method: "PUT"
        }).then(response => response.json())
            .then(json => { });
    }
</script>

<div class="jumbotron jumbotron-fluid mt-3 mb-0 p-0 w-100 bg-big-logo">
    <img alt="many vegetables with greenMeal logo" class="w-100" src="../imgs/background.jpg">
</div>
<div class="container-fluid yellow-background mt-0 pt-3 ">
    <div class="h2 green text-center mb-2 mt-0 font-weight-bold">How it works</div>
    <div class="row justify-content-sm-center">
        <div class="col text-center">
            <img src="../imgs/many-vegetables.jpg" class="hiw-leaf p-2">
            <h4 class="h3 green text-center mt-1 font-weight-bold">We provide fresh ingredients</h4>
            <p>Along with delicious recipes to bring you the most healthy meals.
                All items are organic, cruelty-free and most are local.</p>
        </div>
        <div class="col text-center">
            <img src="../imgs/healthy-food.jpg" class="hiw-leaf p-2">
            <h4 class="h3 green text-center mt-1 font-weight-bold">You pick the meals and restrictions</h4>
            <p>All ingredients are listed so you know you will not have any surprises.</p>
        </div>
        <div class="col text-center">
            <img src="../imgs/calendar.jpg" class="hiw-leaf p-2">
            <h4 class="h3 green text-center mt-1 font-weight-bold">Choose you weekday for delivery</h4>
            <p>We adapt our logistics to fulfill your needs, not the opposite. The delivery is
                done in returnable refrigerated containers, this is for maximum freshness and
                a more efficient environmental footprint. </p>
        </div>
    </div>
</div>
<div class="container-fluid grey-background mt-0 pt-3  w-100">
    <div class="h2 green text-center mb-2 mt-0 font-weight-bold">Featured Recipes</div>
    <div class="container-fluid">
        <div class="row text-center d-flex justify-content-center text-center">
            {{#each data}}
            {{#if featured}}
            <div class="col-12 col-sm-8 col-md-4 col-lg-3 mb-lg-4 mb-md-2 mb-sm-3 mb-3">
                <div class="card text-center h-100 shadow">
                    <div class="card-header h2 text-dark">{{title}}</div>
                    <img src="/imgs/products/{{_id}}.jpg" alt="Picture of {{title}}" class="card-img-top">
                    <div class="card-footer mt-0">
                        <p class="text-muted mt-0 mb-1">CAD$ <span
                                class="text-danger font-weight-bold h4">{{price}}</span></p>
                        <p class="mb-1 mt-0"><span class="text-muted">Category: {{category}}</span><a href=""
                                data-toggle="modal" data-target="#card{{_id}}-modal"> + Details</a></p>
                        {{!-- <button class="btn btn-success">Add to Cart</button> --}}
                        {{!-- testing button --}}
                        {{!-- <form  action="/cart/{{_id}}" action="POST">
                            <input value="{{_id}}" name="_id" />
                            <input type="submit" class="btn btn-success" value="Add to Cart3"/>
                        </form>
                        <a class="btn btn-success" href="/cart/{{_id}}">Add to Cart2</a> --}}
                        {{#if ../user}}
                        {{#if ../user.isDataClerk}}
                        <button type="button" class="btn btn-secondary" data-toggle="popover" data-trigger="focus"
                            title="Error" data-placement="bottom"
                            data-content="Only regular users my add item. Login in your regular user account.">Add to
                            Cart</button>
                        {{else}}
                        <button type="button" class="btn btn-success" onclick="addToCart('{{_id}}')"
                            data-toggle="popover" data-trigger="focus" title="Added to Cart" data-placement="bottom"
                            data-content="Keep adding more meals. Click anywhere to dismiss.">Add to Cart</button>
                        {{/if}}
                        {{else}}
                        <button type="button" class="btn btn-secondary" data-toggle="popover" data-trigger="focus"
                            title="Error" data-placement="bottom"
                            data-content="Only logged users my add item. Login in your user account.">Add to
                            Cart</button>
                        {{/if}}
                    </div>
                </div>
            </div>
            {{/if}}
            {{/each}}
        </div>
    </div>
</div>

{{#each data}}
<div class="modal fade mt-5" id="card{{_id}}-modal" role="dialog">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="card text-center h-100 shadow">
                <div class="card-header h3 text-dark">{{title}}</div>
                <img src="/imgs/products/{{_id}}.jpg" alt="Picture of {{title}}" class="card-img-top">
                <div class="card-body mb-0 pb-0">
                    <p class="text-muted mt-0 mb-1">{{description}}</p>

                    <div class="row">
                        <div class="col-6">
                            <p class="text-muted mt-0 mb-1">Ingredients: {{ingredients}}</p>
                        </div>
                        <div class="col-6">
                            <p class="text-muted mt-0 mb-1">Cooking Time: {{cookingTime}}</p>
                            <p class="text-muted mt-0 mb-1">Calories: {{calories}} kcal</p>
                        </div>
                    </div>
                    <p class="text-muted mt-0 mb-1">CAD$ <span class="text-danger font-weight-bold h4">{{price}}</span>
                    </p>
                </div>
                <div class="card-footer mt-0">
                    <p class="mb-1 mt-0"><span class="text-muted">Category: {{category}} Available:
                            {{#if available}}
                            <span class="text-success"> Yes</span>
                            {{#else}}
                            <span class="text-danger"> No</span>
                            {{/else}}
                            {{/if}}</span>
                    </p>
                    <button class="btn btn-success" onclick="">Add to Cart</button>
                </div>
            </div>
        </div>
    </div>
</div>
{{/each}}